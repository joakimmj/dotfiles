#!/usr/bin/env bash
dirs="~/dev ~/dev/private"
if [[ $# -eq 1 ]]; then
    path=$1
else
    path=$(eval "find -L $dirs -mindepth 1 -maxdepth 1 -type d | fzf")
fi
if [[ -z $path ]]; then
    exit 0
fi
selected_dir=$(basename "$path" | tr . _)
tmux_running=$(pgrep tmux)
create_window() {
    if ! tmux select-window -t=$selected_dir 2> /dev/null; then
        tmux new-window -t dev -n $selected_dir -c $path
    fi
}
if [[ -z $TMUX ]] || [[ -z $tmux_running ]]; then
    tmux new-session -d -s dev -n home -c ~/
    create_window
    tmux attach-session -d -t dev
    exit 0
fi
if ! tmux has-session -t=dev 2> /dev/null; then
    tmux new-session -d -s dev -n home -c ~/
fi

tmux switch-client -t dev
create_window
